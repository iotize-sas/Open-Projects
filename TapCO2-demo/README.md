# TapCO2

This project creates a connected CO2 sensor using a TapNLink module. The project uses TapNLink's embedded Java Virtual Machine (JVM) as the application processor. The JVM runs a simple Java program retrieves data from sensor.

## *** DISCLAIMER ***

<p>This electrical project is provided ONLY for testing and experimentation by qualified persons in electronics design labs.</p>

<p>The person reproducing this example accepts full responsibility to any injury, or damage that may result.</p>

<p>This example is not a product. This example is not Certified, Qualified, Approved, or Recommended for any commercial use, or for any use by the general public.</p>

>> Note: Before starting, learn how TapNLink and the associated tools work in this [Getting Started](http://docs.iotize.com/GettingStarted/).

This project is on [GitHub](https://github.com/iotize-sas/Open-Projects/tree/main/TapCO2-demo) !

The project has 4 folders:

- `app_generated/TapCO2.apk`: The sources for the mobile application that was automatically generated by the IoTize mobile app build server.
- `java/TapCO2.java`: The Java code that is executed by the `JVM`.
- `iotize_studio/TapCO2.iotz`: The IoTize Studio configuration file that is used to configure the TapNLink for this demo.
- `doc`: The illustrations and the readme file for the `Java` code.


## The Main Components

The main components in this project, and where you can purchase them are:
- The TapNLink communication module [is available from these distributors](https://www.iotize.com/iotize-distributors.html).

## How it Works

The components are placed in a case with holes for a better quality of results. The pictures below show the hardware set up :

<p align="center">
<img src="https://github.com/iotize-sas/Open-Projects/blob/main/TapCO2-demo/doc/images/1.jpg" width="250">
</p>
<p align="center">
    <em>TapCO2 components</em>
</p>

- Tap and CO2 Sensor are separated so that the heat released by Tap does not affect the recovered values.

<p align="center">
<img src="https://github.com/iotize-sas/Open-Projects/blob/main/TapCO2-demo/doc/images/2.jpg" width="250">
</p>
<p align="center">
    <em>The CO2 sensor</em>
</p>

- The co2 sensor is powered by the battery.

<p align="center">
<img src="https://github.com/iotize-sas/Open-Projects/blob/main/TapCO2-demo/doc/images/3.jpg" width="250">
</p>
<p align="center">
    <em>TapNLink</em>
</p>

- The Tap is connected to the CO2 sensor by I2C and is powered by the sensor.

## Overview

<p align="center">
<img src="https://github.com/iotize-sas/Open-Projects/blob/main/TapCO2-demo/doc/images/overview.jpg">
</p>
<p align="center">
    <em>General view of the project</em>
</p>
<p>
The general diagram shows the battery connected to the sensor. The TapNLink module reads the information from the sensor with I2C communication. This data is viewed in an app that is generated automatically by the IoTize software tools based on the configuration of the TapNLink.
</p>

## Schematic 

<p align="center">
<img src="https://github.com/iotize-sas/Open-Projects/blob/main/TapCO2-demo/doc/images/schematic.png">
</p>
<p align="center">
    <em>Electrical diagram</em>
</p>

## Java Code

In the `Java` code executed by the `JVM`, the `onCheck()` method is called periodically (the period is specified in the `TapNLinkVar` construct). With this method, we get an image of the power by considering the differences of the pulse counts during the elapsed time period. 

- For more `Java` code information, [click here](https://github.com/iotize-sas/Open-Projects/tree/main/TapCO2-demo/doc/Java_code/Java_code.md) !


## IoTize Studio

1. Open the TapNLink configuration project `iotize_studio/TapCO2.iotz` with IoTize Studio. For more information about Studio, [click here](http://docs.iotize.com/UserManuals/IotizeStudio/).
2. In the `IoTize_Studio/Tap` section, set `User internal JVM` to `Yes` and set the `.java` file path `java/TapCO2.java`.
3. In IoTize Studio, execute `java` build to generate the `.bcb` file. 
4. Configure your `TapNLink` with `IoTize Studio` :
    -  [Setup the connection to your TapNLink](http://docs.iotize.com/UserManuals/DiverseTools/)
    -  [Set the IoT Platform (MQTT) information](http://docs.iotize.com/Technologies/AWSIot/).
    -  Click on the `Configure` button and wait for the end of the configuration process. 
5. Reboot the TapNLink to apply the new configuration. 


## Running the 'TapCO2' App

- Because this app has not been published on the app stores, you have to install it manually. See how this is done [here](https://github.com/iotize-sas/Open-Projects/tree/main/TapCO2-demo/app_generated/TapCO2.apk).
- After your circuit is properly connected, and your TapNLink configured, launch the mobile app. The fastest way is to approach your mobile phone (with NFC enabled) to the plastic casing. NFC will launch the app and connect the mobile to the TapNLink automatically. 

<p align="center">
<img src="https://github.com/iotize-sas/Open-Projects/blob/main/TapCO2-demo/doc/images/4.jpg" width="400">
</p>
<p align="center">
   <em>TapCO2 connected</em>
</p>

- With `TapNLink`, you can now monitor the instantaneous value, or the percentage data that has been stored in the module. 

<p align="center">
<img src="https://github.com/iotize-sas/Open-Projects/blob/main/TapCO2-demo/doc/images/app.jpg" width="200">
</p>
<p align="center">
    <em>Viewing in the app</em>
</p>